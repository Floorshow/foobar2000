cInputbox={temp_gr:gdi.CreateImage(1,1).GetGraphics(),timer_cursor:!1,cursor_state:!0,doc:new ActiveXObject("htmlfile"),clipboard:null},oInputbox=function(w,h,default_text,empty_text,textcolor,backcolor,bordercolor,backselectioncolor,func,parentObjectName){this.font=gdi.Font("arial",13,0),this.font_italic=gdi.Font("arial",13,2),this.w=w,this.h=h,this.textcolor=textcolor,this.backcolor=backcolor,this.bordercolor=bordercolor,this.backselectioncolor=backselectioncolor,this.default_text=default_text,this.text=default_text,this.prev_text="01234567890123456789",this.empty_text=empty_text,this.stext="",this.prev_text="",this.func=func;var gfunc=func,gfunc_launch_timer=!1,g_parentObjectName=parentObjectName;this.autovalidation=!1,this.edit=!1,this.select=!1,this.hover=!1,this.Cpos=0,this.Cx=0,this.offset=0,this.right_margin=2,this.drag=!1,this.setSize=function(t,s,i){this.w=t,this.h=s,this.font=gdi.Font("arial",i,0),this.font_italic=gdi.Font("arial",i,2)},this.draw=function(t,s,i){if(this.x=s,this.y=i,this.edit)var e=DT_LEFT|DT_VCENTER|DT_SINGLELINE|DT_NOPREFIX|DT_CALCRECT;else e=DT_LEFT|DT_VCENTER|DT_SINGLELINE|DT_NOPREFIX|DT_CALCRECT|DT_END_ELLIPSIS;if(t.SetSmoothingMode(0),this.bordercolor&&t.FillSolidRect(s-2,i+0,this.w+4,this.h-0,this.bordercolor),t.FillSolidRect(s-1,i+1,this.w+2,this.h-2,this.backcolor),!this.drag&&!this.select)for(this.Cx=cInputbox.temp_gr.CalcTextWidth(this.text.substr(this.offset,this.Cpos-this.offset),this.font);this.Cx>=this.w-this.right_margin;)this.offset++,this.Cx=cInputbox.temp_gr.CalcTextWidth(this.text.substr(this.offset,this.Cpos-this.offset),this.font);if(this.SelBegin!=this.SelEnd){if(this.select=!0,this.CalcText(),this.SelBegin<this.SelEnd){if(this.SelBegin<this.offset)var h=this.x;else h=this.x+this.GetCx(this.SelBegin);h=this.GetCx(this.SelBegin);var o=this.GetCx(this.SelEnd);this.text_selected=this.text.substring(this.SelBegin,this.SelEnd)}else{if(this.SelEnd<this.offset)h=this.x;else h=this.x-this.GetCx(this.SelBegin);o=this.GetCx(this.SelBegin),h=this.GetCx(this.SelEnd);this.text_selected=this.text.substring(this.SelEnd,this.SelBegin)}this.x+h+(o-h)>this.x+this.w?t.FillSolidRect(this.x+h,this.y+1,this.w-h,this.h-3,1358954495&this.backselectioncolor):t.FillSolidRect(this.x+h,this.y+1,o-h,this.h-3,1358954495&this.backselectioncolor)}else this.select=!1,this.text_selected="";this.text.length>0?t.GdiDrawText(this.text.substr(this.offset),this.font,this.edit?this.textcolor:blendColors(this.textcolor,0==this.backcolor?4278190080:this.backcolor,.35),this.x,this.y,this.w,this.h,e):t.GdiDrawText(this.empty_text,this.font_italic,blendColors(this.textcolor,0==this.backcolor?4278190080:this.backcolor,.35),this.x,this.y,this.w,this.h,e),this.edit&&!this.select&&this.drawcursor(t)},this.drawcursor=function(t){if(cInputbox.cursor_state&&this.Cpos>=this.offset){this.Cx=this.GetCx(this.Cpos);var s=this.x+this.Cx,i=s,e=this.y+1,h=this.y+this.h-3;t.DrawLine(s,e,i,h,1,this.textcolor)}},this.repaint=function(){eval(g_parentObjectName+".repaint()")},this.CalcText=function(){var t=cInputbox.temp_gr.GdiDrawText(this.text.substr(this.offset),this.font,0,0,0,9999999,9999999,DT_NOPREFIX|DT_CALCRECT).toArray();this.TLength=t[4],this.TWidth=cInputbox.temp_gr.CalcTextWidth(this.text.substr(this.offset),this.font)},this.GetCx=function(t){if(t>=this.offset)var s=cInputbox.temp_gr.CalcTextWidth(this.text.substr(this.offset,t-this.offset),this.font);else s=0;return s},this.GetCPos=function(t){for(var s=t-this.x,i=0,e=this.offset;e<this.text.length&&!((i+=cInputbox.temp_gr.CalcTextWidth(this.text.substr(e,1),this.font))>=s+3);e++);return e},this.on_focus=function(t){!t&&this.edit?(0==this.text.length&&(this.text=this.default_text),this.edit=!1,cInputbox.timer_cursor&&(window.ClearInterval(cInputbox.timer_cursor),cInputbox.timer_cursor=!1,cInputbox.cursor_state=!0),this.repaint()):t&&this.edit&&this.resetCursorTimer()},this.resetCursorTimer=function(){cInputbox.timer_cursor&&(window.ClearInterval(cInputbox.timer_cursor),cInputbox.timer_cursor=!1,cInputbox.cursor_state=!0),cInputbox.timer_cursor=window.SetInterval(function(){cInputbox.cursor_state=!cInputbox.cursor_state,eval(g_parentObjectName+".repaint()")},500)},this.check=function(t,s,i){switch(this.hover=s>=this.x-2&&s<=this.x+this.w+1&&i>this.y&&i<this.y+this.h,t){case"down":this.hover?(this.dblclk=!1,this.drag=!0,this.edit=!0,this.Cpos=this.GetCPos(s),this.anchor=this.Cpos,this.SelBegin=this.Cpos,this.SelEnd=this.Cpos,this.resetCursorTimer()):(this.edit=!1,this.select=!1,this.SelBegin=0,this.SelEnd=0,this.text_selected="",cInputbox.timer_cursor&&(window.ClearInterval(cInputbox.timer_cursor),cInputbox.timer_cursor=!1,cInputbox.cursor_state=!0)),this.repaint();break;case"up":!this.dblclk&&this.drag?(this.SelEnd=this.GetCPos(s),this.select&&this.SelBegin>this.SelEnd&&(this.sBeginSel=this.SelBegin,this.SelBegin=this.SelEnd,this.SelEnd=this.sBeginSel)):this.dblclk=!1,this.drag=!1;break;case"dblclk":this.hover&&(this.dblclk=!0,this.SelBegin=0,this.SelEnd=this.text.length,this.text_selected=this.text,this.select=!0,this.repaint());break;case"move":if(this.drag){this.CalcText();var e=this.GetCPos(s),h=this.GetCx(e);if(e<this.SelBegin){if(e<this.SelEnd)h<this.x&&this.offset>0&&(this.offset--,this.repaint());else if(e>this.SelEnd){if(h+this.x>this.x+this.w)(this.TWidth>this.w?this.TWidth-this.w:0)>0&&(this.offset++,this.repaint())}this.SelEnd=e}else if(e>this.SelBegin){if(h+this.x>this.x+this.w)(this.TWidth>this.w?this.TWidth-this.w:0)>0&&(this.offset++,this.repaint());this.SelEnd=e}this.Cpos=e,this.repaint()}this.hover||this.drag?window.SetCursor(IDC_IBEAM):this.ibeam_set&&window.SetCursor(IDC_ARROW),this.ibeam_set=this.hover||this.drag;break;case"right":this.hover?(this.edit=!0,this.resetCursorTimer(),this.repaint(),this.show_context_menu(s,i)):(this.edit=!1,this.select=!1,this.SelBegin=0,this.SelEnd=0,this.text_selected="",cInputbox.timer_cursor&&(window.ClearInterval(cInputbox.timer_cursor),cInputbox.timer_cursor=!1,cInputbox.cursor_state=!0),this.repaint())}},this.show_context_menu=function(t,s){var i=window.CreatePopupMenu();switch(cInputbox.clipboard=cInputbox.doc.parentWindow.clipboardData.getData("Text"),i.AppendMenuItem(this.select?MF_STRING:MF_GRAYED|MF_DISABLED,1,"Copy"),i.AppendMenuItem(this.select?MF_STRING:MF_GRAYED|MF_DISABLED,2,"Cut"),i.AppendMenuSeparator(),i.AppendMenuItem(cInputbox.clipboard?MF_STRING:MF_GRAYED|MF_DISABLED,3,"Paste"),utils.IsKeyPressed(VK_SHIFT)&&(i.AppendMenuSeparator(),i.AppendMenuItem(MF_STRING,20,"Properties"),i.AppendMenuItem(MF_STRING,21,"Configure...")),i.TrackPopupMenu(t,s)){case 1:this.edit&&this.select&&cInputbox.doc.parentWindow.clipboardData.setData("Text",this.text_selected);break;case 2:if(this.edit&&this.select){cInputbox.doc.parentWindow.clipboardData.setData("Text",this.text_selected);var e=this.SelBegin,h=this.SelEnd;this.offset=this.offset>=this.text_selected.length?this.offset-this.text_selected.length:0,this.select=!1,this.text_selected="",this.Cpos=this.SelBegin,this.SelEnd=this.SelBegin,this.text=this.text.slice(0,e)+this.text.slice(h),this.CalcText(),this.repaint(),gfunc()}break;case 3:if(this.edit&&cInputbox.clipboard){if(this.select){e=this.SelBegin,h=this.SelEnd;this.select=!1,this.text_selected="",this.Cpos=this.SelBegin,this.SelEnd=this.SelBegin,this.Cpos<this.text.length?this.text=this.text.slice(0,e)+cInputbox.clipboard+this.text.slice(h):this.text=this.text+cInputbox.clipboard,this.Cpos+=cInputbox.clipboard.length,this.CalcText(),this.repaint()}else this.Cpos>0?this.text=this.text.substring(0,this.Cpos)+cInputbox.clipboard+this.text.substring(this.Cpos,this.text.length):this.text=cInputbox.clipboard+this.text.substring(this.Cpos,this.text.length),this.Cpos+=cInputbox.clipboard.length,this.CalcText(),this.repaint();gfunc()}break;case 20:window.ShowProperties();break;case 21:window.ShowConfigure()}i.Dispose()},this.on_key_down=function(t){this.resetCursorTimer();var s=GetKeyboardMask();this.on_key(t,s)},this.on_key=function(vkey,mask){if(mask==KMask.none){switch(vkey){case VK_SHIFT:break;case VK_BACK:this.stext=this.text,this.edit&&(this.select?this.text_selected.length==this.text.length?(this.text="",this.Cpos=0):this.SelBegin>0?(this.text=this.text.substring(0,this.SelBegin)+this.text.substring(this.SelEnd,this.text.length),this.Cpos=this.SelBegin):(this.text=this.text.substring(this.SelEnd,this.text.length),this.Cpos=this.SelBegin):this.Cpos>0&&(this.text=this.text.substr(0,this.Cpos-1)+this.text.substr(this.Cpos,this.text.length-this.Cpos),this.offset>0&&this.offset--,this.Cpos--,this.repaint())),this.CalcText(),this.offset=this.offset>=this.text_selected.length?this.offset-this.text_selected.length:0,this.text_selected="",this.SelBegin=this.Cpos,this.SelEnd=this.SelBegin,this.select=!1,this.repaint();break;case VK_DELETE:this.stext=this.text,this.edit&&(this.select?this.text_selected.length==this.text.length?(this.text="",this.Cpos=0):this.SelBegin>0?(this.text=this.text.substring(0,this.SelBegin)+this.text.substring(this.SelEnd,this.text.length),this.Cpos=this.SelBegin):(this.text=this.text.substring(this.SelEnd,this.text.length),this.Cpos=this.SelBegin):this.Cpos<this.text.length&&(this.text=this.text.substr(0,this.Cpos)+this.text.substr(this.Cpos+1,this.text.length-this.Cpos-1),this.repaint())),this.CalcText(),this.offset=this.offset>=this.text_selected.length?this.offset-this.text_selected.length:0,this.text_selected="",this.SelBegin=this.Cpos,this.SelEnd=this.SelBegin,this.select=!1,this.repaint();break;case VK_RETURN:this.edit&&this.text.length>=0&&eval(this.func);break;case VK_ESCAPE:this.edit&&(this.edit=!1,this.text_selected="",this.select=!1,this.repaint());break;case VK_END:this.edit&&(this.Cpos=this.text.length,this.SelBegin=0,this.SelEnd=0,this.select=!1,this.repaint());break;case VK_HOME:this.edit&&(this.Cpos=0,this.SelBegin=0,this.SelEnd=0,this.select=!1,this.offset=0,this.repaint());break;case VK_LEFT:this.edit&&(this.offset>0?this.Cpos<=this.offset?(this.offset--,this.Cpos--):this.Cpos--:this.Cpos>0&&this.Cpos--,this.SelBegin=this.Cpos,this.SelEnd=this.Cpos,this.select=!1,this.repaint());break;case VK_RIGHT:this.edit&&(this.Cpos<this.text.length&&this.Cpos++,this.SelBegin=this.Cpos,this.SelEnd=this.Cpos,this.select=!1,this.repaint())}this.edit&&this.repaint()}else switch(mask){case KMask.shift:if(vkey==VK_HOME&&this.edit&&(this.select?this.Cpos>0&&(this.anchor<this.Cpos?(this.SelBegin=0,this.SelEnd=this.anchor):this.anchor>this.Cpos&&(this.SelBegin=0),this.Cpos=0):(this.anchor=this.Cpos,this.select=!0,this.Cpos>0&&(this.SelEnd=this.Cpos,this.SelBegin=0,this.select=!0,this.Cpos=0)),this.offset>0&&(this.offset=0),this.repaint()),vkey==VK_END&&this.edit){for(this.select?this.Cpos<this.text.length&&(this.anchor<this.Cpos?this.SelEnd=this.text.length:this.anchor>this.Cpos&&(this.SelBegin=this.anchor,this.SelEnd=this.text.length),this.Cpos=this.text.length):(this.anchor=this.Cpos,this.Cpos<this.text.length&&(this.SelBegin=this.Cpos,this.SelEnd=this.text.length,this.Cpos=this.text.length,this.select=!0)),this.Cx=cInputbox.temp_gr.CalcTextWidth(this.text.substr(this.offset,this.Cpos-this.offset),this.font);this.Cx>=this.w-this.right_margin;)this.offset++,this.Cx=cInputbox.temp_gr.CalcTextWidth(this.text.substr(this.offset,this.Cpos-this.offset),this.font);this.repaint()}if(vkey==VK_LEFT&&this.edit){if(this.select?this.Cpos>0&&(this.anchor<this.Cpos?this.SelEnd--:this.anchor>this.Cpos&&this.SelBegin--,this.Cpos--):(this.anchor=this.Cpos,this.select=!0,this.Cpos>0&&(this.SelEnd=this.Cpos,this.SelBegin=this.Cpos-1,this.select=!0,this.Cpos--)),this.offset>0){var tmp=this.Cpos,tmp_x=this.GetCx(tmp);tmp<this.offset&&this.offset--}this.repaint()}if(vkey==VK_RIGHT&&this.edit){this.select?this.Cpos<this.text.length&&(this.anchor<this.Cpos?this.SelEnd++:this.anchor>this.Cpos&&this.SelBegin++,this.Cpos++):(this.anchor=this.Cpos,this.Cpos<this.text.length&&(this.SelBegin=this.Cpos,this.Cpos++,this.SelEnd=this.Cpos,this.select=!0));var tmp_x=this.GetCx(this.Cpos);tmp_x>this.w-this.right_margin&&this.offset++,this.repaint()}break;case KMask.ctrl:if(65==vkey&&this.edit&&this.text.length>0&&(this.SelBegin=0,this.SelEnd=this.text.length,this.text_selected=this.text,this.select=!0,this.repaint()),67==vkey&&this.edit&&this.select&&cInputbox.doc.parentWindow.clipboardData.setData("Text",this.text_selected),88==vkey&&this.edit&&this.select){this.stext=this.text,cInputbox.doc.parentWindow.clipboardData.setData("Text",this.text_selected);var p1=this.SelBegin,p2=this.SelEnd;this.select=!1,this.text_selected="",this.Cpos=this.SelBegin,this.SelEnd=this.SelBegin,this.text=this.text.slice(0,p1)+this.text.slice(p2),this.CalcText(),this.repaint()}if(90==vkey&&this.edit&&(this.text=this.stext,this.repaint()),86==vkey&&(cInputbox.clipboard=cInputbox.doc.parentWindow.clipboardData.getData("Text"),this.edit&&cInputbox.clipboard))if(this.stext=this.text,this.select){var p1=this.SelBegin,p2=this.SelEnd;this.select=!1,this.text_selected="",this.Cpos=this.SelBegin,this.SelEnd=this.SelBegin,this.Cpos<this.text.length?this.text=this.text.slice(0,p1)+cInputbox.clipboard+this.text.slice(p2):this.text=this.text+cInputbox.clipboard,this.Cpos+=cInputbox.clipboard.length,this.CalcText(),this.repaint()}else this.Cpos>0?this.text=this.text.substring(0,this.Cpos)+cInputbox.clipboard+this.text.substring(this.Cpos,this.text.length):this.text=cInputbox.clipboard+this.text.substring(this.Cpos,this.text.length),this.Cpos+=cInputbox.clipboard.length,this.CalcText(),this.repaint()}this.autovalidation&&this.text!=this.prev_text&&(gfunc_launch_timer&&window.ClearTimeout(gfunc_launch_timer),gfunc_launch_timer=window.SetTimeout(function(){gfunc(),gfunc_launch_timer&&window.ClearTimeout(gfunc_launch_timer),gfunc_launch_timer=!1},500),this.prev_text=this.text)},this.on_char=function(t,s){if(1==t&&this.edit&&s==KMask.ctrl&&(this.Spos=0,this.Cpos=this.text.length,this.select=!0,this.repaint()),t>31&&this.edit){if(this.stext=this.text,this.select){var i=this.SelBegin,e=this.SelEnd;this.text_selected="",this.Cpos=this.SelBegin,this.SelEnd=this.SelBegin}else i=this.Cpos,e=-1*(this.text.length-this.Cpos);this.Cpos<this.text.length?this.text=this.text.slice(0,i)+String.fromCharCode(t)+this.text.slice(e):this.text=this.text+String.fromCharCode(t),this.Cpos++,this.select&&(this.CalcText(),this.TWidth<=this.w?this.offset=0:this.Cpos-this.offset<0&&(this.offset=this.offset>0?this.Cpos-1:0),this.select=!1),this.repaint()}this.autovalidation&&this.text!=this.prev_text&&(gfunc_launch_timer&&window.ClearTimeout(gfunc_launch_timer),gfunc_launch_timer=window.SetTimeout(function(){gfunc(),gfunc_launch_timer&&window.ClearTimeout(gfunc_launch_timer),gfunc_launch_timer=!1},500),this.prev_text=this.text)}};